# Protocol Requirements Quality Checklist: Binary Protocol & IO Core

**Purpose**: Validate that the protocol + agent/server requirements in the spec/plan are complete, unambiguous, internally consistent, and measurably testable ("unit tests for English").
**Created**: 2026-01-08
**Feature**: [specs/001-protocol-messaging/spec.md](../spec.md)

**Note**: This checklist is generated by the `/speckit.checklist` command based on feature context and requirements.

## Requirement Completeness

- [ ] CHK001 Are all message types explicitly defined with required/optional fields and clear semantics (handshake, handshake ack, heartbeat, snapshot, ack/nack, backpressure, error)? [Completeness, Spec §FR-002]
- [ ] CHK002 Are all handshake capability flags fully enumerated, including whether cmdline is included and whether all-process snapshots are supported? [Completeness, Spec §FR-001, Spec §FR-004, Spec §Session 2026-01-08]
- [ ] CHK003 Are the allowed platform values for agent metadata explicitly listed and consistent (windows/linux/macos)? [Completeness, Spec §FR-004]
- [ ] CHK004 Are requirements present for how the server responds when a client sends snapshots before handshake completes (reject vs ignore vs error)? [Gap, Spec §FR-004]
- [ ] CHK005 Are requirements present for how storage append failures map to protocol responses (ack vs nack/error) and retry behavior? [Gap, Spec §FR-010, Spec §FR-011]
- [ ] CHK006 Is the file rotation policy for append-to-file storage specified (naming, size/time thresholds, retention), or explicitly deferred? [Gap, Spec §FR-011]

## Requirement Clarity

- [ ] CHK007 Is “when requested and supported” for all-process snapshots defined in measurable terms (what constitutes unsupported; how is it detected; what does the agent send instead)? [Ambiguity, Spec §FR-001, Spec §Session 2026-01-08]
- [ ] CHK008 Is “cmdline permitted by platform” clarified with concrete rules (permission requirements, redaction policy, and when cmdline must be omitted)? [Ambiguity, Spec §FR-005, Spec §Session 2026-01-08]
- [ ] CHK009 Are all time units and encodings unambiguous (UTC Unix milliseconds for timestamps; ms for throttleDelayMs; ms for timeouts/backoff)? [Clarity, Spec §FR-002, Spec §FR-006, Spec §FR-007]
- [ ] CHK010 Are ack/nack semantics defined precisely for each message class (which messages require ack, timeout behavior, and whether server can nack vs only error)? [Clarity, Spec §FR-007, Spec §FR-009]
- [ ] CHK011 Is the plaintext posture clarified beyond “dev-only” (what is the default behavior; what explicit opt-in exists; what constitutes “production” in terms of enforcement)? [Ambiguity, Spec §FR-008]

## Requirement Consistency

- [ ] CHK012 Do spec platform/capability requirements match the data model definitions (platform enum values; capability flags list)? [Consistency, Spec §FR-001, Spec §FR-004, Data Model §ProtocolEnvelope/Handshake]
- [ ] CHK013 Do spec framing and checksum requirements match any related documentation/contracts (OpenAPI diagnostics doc, quickstart notes) without conflicting CRC algorithm or layout? [Consistency, Spec §FR-002, Contracts §/ingest/frame, Quickstart §Notes]
- [ ] CHK014 Do the tasks and quickstart align with the spec for plaintext posture and guardrails (e.g., “explicit opt-in” vs default allowed)? [Consistency, Spec §FR-008, Quickstart §Security: plaintext dev-only, Tasks §T064]
- [ ] CHK015 Are the retry/backoff defaults consistent anywhere they appear (spec vs quickstart vs tasks) and free of contradictions (e.g., jitter vs no jitter)? [Consistency, Spec §FR-007, Quickstart §Defaults]

## Acceptance Criteria Quality

- [ ] CHK016 Are success criteria tied to specific user stories/requirements with measurable thresholds and clear measurement conditions (env, load, link characteristics)? [Measurability, Spec §SC-001–SC-004]
- [ ] CHK017 Is “decode success ≥ 99.5%” defined with a concrete denominator and measurement method (per-frame vs per-snapshot; how errors are counted)? [Ambiguity, Spec §SC-002]
- [ ] CHK018 Are performance targets stated in a way that can be objectively validated without implementation-specific tooling assumptions? [Measurability, Spec §SC-003]

## Scenario Coverage

- [ ] CHK019 Are handshake failure scenarios fully specified (no overlapping versions; explicit error; connection close vs continue)? [Coverage, Spec §FR-003]
- [ ] CHK020 Are reconnect/resend scenarios defined with ordering and dedupe expectations (oldest-first resend; dedupe scope per-session)? [Coverage, Spec §FR-007]
- [ ] CHK021 Are oversized snapshot behaviors completely specified (compression negotiation, segmentation rules, reassembly requirements, per-part ack)? [Coverage, Spec §FR-009]
- [ ] CHK022 Are backpressure scenarios specified for both normal and “signal lost in-flight” cases (agent behavior before observing throttleDelayMs)? [Coverage, Spec §FR-006, Spec §Edge Cases]
- [ ] CHK023 Are error-handling scenarios specified for corrupted frames including whether the session remains alive and what error is emitted? [Coverage, Spec §US3, Spec §FR-002]

## Edge Case Coverage

- [ ] CHK024 Are partial-frame / stream-cut conditions specified with deterministic reassembly/reader behavior (e.g., buffering policy, max buffered bytes, timeout)? [Gap, Spec §Edge Cases]
- [ ] CHK025 Are “unknown optional fields” behaviors specified consistently across encoding/decoding (ignore vs record) including where “recorded” data goes? [Clarity, Spec §FR-003]
- [ ] CHK026 Are limits and boundary conditions specified for human-readable strings (e.g., backpressure reason, error detail) to prevent unbounded payload growth? [Gap, Spec §FR-006, Spec §FR-012]

## Non-Functional Requirements

- [ ] CHK027 Are observability requirements specific about what is logged/counted (message counts, error types, backpressure events) and how correlation IDs are represented? [Clarity, Spec §FR-012]
- [ ] CHK028 Are security requirements for plaintext usage specified with enforceable, testable constraints (default-off + explicit opt-in; documentation requirements)? [Clarity, Spec §FR-008]
- [ ] CHK029 Are agent resource constraints (CPU/memory) reflected consistently between constitution targets and spec success criteria, without gaps or contradictions? [Consistency, Constitution §Additional Constraints, Spec §SC-003]

## Dependencies & Assumptions

- [ ] CHK030 Are assumptions about toolchains and native dependencies explicitly documented (Rust/.NET versions, zstd availability) and kept consistent across docs? [Completeness, Quickstart §Prerequisites, Plan §Technical Context]

## Notes

- Items are phrased to evaluate the requirements text (not the implementation).
- Use `[Gap]` to record missing requirement text and propose additions.
